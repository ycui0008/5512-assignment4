---
title: "ETC5512 Assignment 4: An Analysis of US Air Traffic"
subtitle: "Name of your airport"
author: "Firstname Lastname"
date: "June 19,  2020"
output: 
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      cache=TRUE, 
                      messages=FALSE, 
                      warning=FALSE)
library(tidyverse)
library(DBI)
library(ggmap)
library(ggthemes)
```


## `r emo::ji("airplane")` Exercise 1

### a. 
```{r read flight data}
d <- read_csv(here::here("raw_data","On_Time_Reporting_Carrier_On_Time_Performance_(1987_present)_2020_2.csv"))
```

```{r choose one carrier}
ca <- d %>%
  filter(Reporting_Airline == "UA")
save(ca, file = here::here("data","airlines.rda"))
```

```{r choose one airport}
airport <- d %>%
  filter(Origin == "ATL" | Dest == "ATL")
save(airport, file = here::here("data","airport_ATL.rda"))
```


Paragraph...

### b. 
```{r read airport data}
d1 <- read_csv(here::here("raw_data","516691980_T_MASTER_CORD.csv"))
```

```{r join d1 into airport}
airport_location <- d1 %>%
  filter(AIRPORT_IS_CLOSED == 0 & # select the airports are still on businesses at the time
           AIRPORT_IS_LATEST == 1 &
           AIRPORT_COUNTRY_CODE_ISO == "US") %>% 
  select(AIRPORT, DISPLAY_AIRPORT_NAME, LONGITUDE, LATITUDE)

airport_with_log_lat <- airport %>%
  left_join(airport_location, by = c("Origin" = "AIRPORT")) %>%
  rename("Origin_lon" = "LONGITUDE","Origin_lat" = "LATITUDE") %>% # rename origin airport longitude and latitude
  left_join(airport_location, by = c("Dest" = "AIRPORT")) %>%
  rename("Dest_lon" = "LONGITUDE","Dest_lat" = "LATITUDE") # rename dest airport longitude and latitude

save(airport_with_log_lat,file = here::here("data","airports_with_lon_lat.rda"))
```



### c. 
```{r generate a map of US}
usa_bbox <- c(-130, # min long
              20, # min lat
              -60, # max long
              55) # max lat

usa_map <- get_map(location = usa_bbox, source = "osm")
```


```{r flight path}
ggmap(usa_map) + geom_segment(data=airport_with_log_lat, 
                     aes(x=Origin_lon, 
                         xend=Dest_lon,
                         y=Origin_lat,
                         yend=Dest_lat), 
                     colour="#9651A0", alpha=0.01) +
  geom_point(data=airport_with_log_lat, aes(x=Origin_lon, Origin_lat),
             colour="#746FB2", alpha=0.1, size=1) +
  theme_map()
```



## `r emo::ji("airplane")` Exercise 2

### a. 

### b. 

### c. 

### d. 

### e. 

Here is one way to make an animation.

```{r, animation.hook='gifski', out.width="100%", fig.width=4, fig.height=2}
d <- tibble(koala=1:10, kangaroo=1:10)
for (i in 1:10){
  print(ggplot(data=d, aes(x=koala, y=kangaroo)) +
    geom_point(alpha=0.1) +
    geom_point(data=d[i,], colour="red"))
}
```

## `r emo::ji("airplane")` Exercise 3

## `r emo::ji("airplane")` Exercise 4

## References

Cite  the main sources for your work, including R packages used.